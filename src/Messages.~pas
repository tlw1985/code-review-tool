unit CodeMessages;

interface

uses
  ToolsAPi;

  type
    TCodeMessages = class(TBaseDockForm)

     private
       function GetSource[Module: IOTAMOdule]: IOTASourceEditor;
       fSource: IOTASourceEditor;
     public
       procedure AddMessage;
     end;

implementation

function TCodeMessages.SourceEditor(Module : IOTAMOdule) : IOTASourceEditor;
Var
  iFileCount : Integer;
  i : Integer;
Begin
  Result := Nil;
  If Module = Nil Then Exit;
  With Module Do
    Begin
      iFileCount := GetModuleFileCount;
      For i := 0 To iFileCount - 1 Do
      begin
        If GetModuleFileEditor(i).QueryInterface(IOTASourceEditor,
          Result) = S_OK Then
          begin
            Break;
          end;
      end;
    end;
end;

procedure TCodeMessages.AddMessage;
var
  MS : IOTAModuleServices;
  CP: TOTAEditPos;
  strFileName : String;
begin

  MS := BorlandIDEServices AS IOTAModuleServices;
  if not assigned(FSource) then
  begin
    FSource := SourceEditor(MS);
  end;
    strFileName := FSource.FileName;

end;

end.

 